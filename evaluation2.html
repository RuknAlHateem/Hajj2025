
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>نموذج تقييم نهاية الحج - ركن الحطيم</title>
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background-color: #f9f9f9;
      margin: 0;
      padding: 15px;
      direction: rtl;
      max-width: 600px;
      margin-right: auto;
      margin-left: auto;
    }
    header {
      text-align: center;
      margin-bottom: 20px;
    }
    header img {
      width: 150px;
      margin-bottom: 10px;
    }
    header h1 {
      font-size: 20px;
      margin: 0;
      color: #2d9958;
    }
    .section {
      background-color: #ffffff;
      margin-bottom: 20px;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
    .section h2 {
      margin-top: 0;
      background-color: #2d9958;
      color: white;
      padding: 10px;
      border-right: 5px solid #1b6e3c;
      border-radius: 6px;
      font-size: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    label.question {
      display: block;
      margin-top: 20px;
      margin-bottom: 5px;
      font-weight: bold;
      font-size: 15px;
      color: #333;
    }
    input[type="text"], select, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 14px;
      box-sizing: border-box;
    }
    textarea {
      height: 80px;
    }
    .required:after {
      content: " *";
      color: red;
    }
    .submit-btn {
      background-color: #2d9958;
      color: #fff;
      border: none;
      padding: 12px 20px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      width: 100%;
    }
    .counter {
      font-size: 12px;
      color: #e4e4e4;
    }
    .radio-group {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
    }
    .radio-option {
      background-color: #f2f2f2;
      padding: 10px;
      border-radius: 6px;
      flex: 1;
      text-align: center;
      margin-left: 5px;
      cursor: pointer;
      border: 1px solid #ccc;
    }
    .radio-option input {
      display: none;
    }
    .radio-option.selected {
      background-color: #2d9958;
      color: white;
      border-color: #1b6e3c;
    }
  
.radio-option.excellent {
  background-color: #2d9958 !important;
  color: white;
  border-color: #1b6e3c;
}
.radio-option.good {
  background-color: #fab334 !important;
  color: white;
  border-color: #e89f00;
}
.radio-option.average {
  background-color: #e8593a !important;
  color: white;
  border-color: #d34722;
}
.radio-option.poor {
  background-color: #d62c2c !important;
  color: white;
  border-color: #b41d1d;
}


.radio-option input:checked + label,
.radio-option.selected {
  box-shadow: 0 0 0 2px #5552;
}

</style>

  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600&display=swap" rel="stylesheet">
</head>

<body>

<header>
  <img src="logo.png" alt="شعار ركن الحطيم">
  <h1>شركة ركن الحطيم للحج</h1>
</header>


<div class="section" style="background-color: #e6f3ec; border: 1px solid #2d9958;">
  <p style="font-size: 16px; text-align: center; margin: 0;">
    عزيزي الحاج، هذا الاستبيان سيأخذ من وقتك دقيقتين فقط لتقييم الخدمات المقدمة خلال موسم الحج. سيساعدنا ذلك في تحسين الأداء وخدمة ضيوف الرحمن بشكل أفضل.
  </p>
</div>
<form id="hajj-evaluation-form">


  <div class="section">
    <h2><span>القسم الأول: معلومات عامة</span><span class="counter" data-total="2">0/2</span></h2>
    <label>الاسم الثلاثي</label>
    <input type="text" name="name">
    <label>رقم الجوال</label>
    <input type="text" name="mobile">
    <label class="required">الجنس</label>
    <select name="gender" required>
      <option value="">اختر الجنس</option>
      <option>ذكر</option>
      <option>أنثى</option>
    </select>
    <label class="required">الحملة</label>
    <select name="campaign" required>
      <option value="">اختر الحملة</option>
      <option>حملة الخلف</option>
      <option>حملة الراية الخضراء</option>
      <option>حملة الهداية</option>
    </select>
  </div>


  

  
<!-- القسم الثاني: التغذية -->
<div class="section">
    <h2><span>القسم الثاني: التغذية</span><span class="counter" data-total="6">0/6</span></h2>

    <label class="question required">1. تنوع الوجبات المقدمة خلال الموسم</label>
    <div class="radio-group" data-name="q1">
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q1" value="راضي جداً"> راضي جداً</label>
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q1" value="راضي"> راضي</label>
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q1" value="محايد"> محايد</label>
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q1" value="غير راضي"> غير راضي</label>
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q1" value="غير راضي على الإطلاق"> غير راضي على الإطلاق</label>
    </div>

    <label class="question required">2. جودة الطعام المقدم من حيث الطعم والنظافة</label>
    <div class="radio-group" data-name="q2">
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q2" value="راضي جداً"> راضي جداً</label>
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q2" value="راضي"> راضي</label>
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q2" value="محايد"> محايد</label>
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q2" value="غير راضي"> غير راضي</label>
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q2" value="غير راضي على الإطلاق"> غير راضي على الإطلاق</label>
    </div>

    <label class="question required">3. مدى التزام مواعيد تقديم الوجبات</label>
    <div class="radio-group" data-name="q3">
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q3" value="راضي جداً"> راضي جداً</label>
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q3" value="راضي"> راضي</label>
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q3" value="محايد"> محايد</label>
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q3" value="غير راضي"> غير راضي</label>
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q3" value="غير راضي على الإطلاق"> غير راضي على الإطلاق</label>
    </div>

    <label class="question required">4. جودة الوجبات من حيث السخونة والبرودة والطراوة</label>
    <div class="radio-group" data-name="q4">
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q4" value="راضي جداً"> راضي جداً</label>
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q4" value="راضي"> راضي</label>
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q4" value="محايد"> محايد</label>
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q4" value="غير راضي"> غير راضي</label>
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q4" value="غير راضي على الإطلاق"> غير راضي على الإطلاق</label>
    </div>

    <label class="question required">5. تنوع المأكولات الخفيفة وتوفرها</label>
    <div class="radio-group" data-name="q5">
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q5" value="راضي جداً"> راضي جداً</label>
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q5" value="راضي"> راضي</label>
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q5" value="محايد"> محايد</label>
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q5" value="غير راضي"> غير راضي</label>
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q5" value="غير راضي على الإطلاق"> غير راضي على الإطلاق</label>
    </div>

    <label class="question required">6. توفر المشروبات وتنوعها</label>
    <div class="radio-group" data-name="q6">
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q6" value="راضي جداً"> راضي جداً</label>
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q6" value="راضي"> راضي</label>
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q6" value="محايد"> محايد</label>
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q6" value="غير راضي"> غير راضي</label>
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q6" value="غير راضي على الإطلاق"> غير راضي على الإطلاق</label>
    </div>

    <label class="question required">7. ما رأيك في وجبة الفطور بشكل عام</label>
    <div class="radio-group" data-name="q7">
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q7" value="راضي جداً"> راضي جداً</label>
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q7" value="راضي"> راضي</label>
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q7" value="محايد"> محايد</label>
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q7" value="غير راضي"> غير راضي</label>
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q7" value="غير راضي على الإطلاق"> غير راضي على الإطلاق</label>
    </div>

    <label class="question required">8. ما رأيك في وجبة الغداء بشكل عام</label>
    <div class="radio-group" data-name="q8">
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q8" value="راضي جداً"> راضي جداً</label>
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q8" value="راضي"> راضي</label>
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q8" value="محايد"> محايد</label>
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q8" value="غير راضي"> غير راضي</label>
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q8" value="غير راضي على الإطلاق"> غير راضي على الإطلاق</label>
    </div>

    <label class="question required">9. ما رأيك في وجبة العشاء بشكل عام</label>
    <div class="radio-group" data-name="q9">
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q9" value="راضي جداً"> راضي جداً</label>
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q9" value="راضي"> راضي</label>
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q9" value="محايد"> محايد</label>
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q9" value="غير راضي"> غير راضي</label>
      <label class="radio-option"><input type="radio" onclick="this.parentElement.click();" name="q9" value="غير راضي على الإطلاق"> غير راضي على الإطلاق</label>
    </div>

</div>

<!-- النقل، اللوجستيات، منى، عرفة -->






  
<!-- القسم السابع: الملاحظات والاقتراحات -->
<div class="section">
  <h2><span>القسم السابع: الملاحظات والاقتراحات</span><span class="counter" data-total="3">0/3</span></h2>
  <label class="question">ما هي أبرز الإيجابيات التي لاحظتها خلال الموسم؟</label>
  <textarea name="positive"></textarea>
  <label class="question">ما هي أبرز التحديات أو السلبيات التي واجهتك؟</label>
  <textarea name="negative"></textarea>
  <label class="question">هل لديك أي اقتراحات لتحسين الخدمات في المواسم القادمة؟</label>
  <textarea name="suggestions"></textarea>
</div>
<div class="section">
    <button type="submit" class="submit-btn">إرسال التقييم</button>
  </div>

</form>

 


<div id="loading" style="display:none;text-align:center;padding:20px;">
  <p>جاري الإرسال، يرجى الانتظار...</p>
</div>
<div id="thankyou" style="display:none;text-align:center;padding:20px;">
  <h3 style="color:#2d9958;">شكرًا لتقييمك، نسأل الله أن يكتب أجرك ويوفقك لخدمة الحجاج.</h3>
</div>















<script>
  const form = document.getElementById("hajj-evaluation-form");
  const loading = document.getElementById("loading");
  const thankyou = document.getElementById("thankyou");

  const firebaseConfig = {
    apiKey: "AIzaSyCjLt3g-2GPsMlxXPnzySXpCHl3-FyA80I",
    authDomain: "hajj2025-56177.firebaseapp.com",
    projectId: "hajj2025-56177",
    storageBucket: "hajj2025-56177.firebasestorage.app",
    messagingSenderId: "199404422758",
    appId: "1:199404422758:web:35a17e6155f660e0128fa7",
    measurementId: "G-T5NYMDX68Z"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  form.addEventListener("submit", async function(event) {
    event.preventDefault();
    form.style.display = "none";
    loading.style.display = "block";

    const formData = new FormData(form);
    const all = Object.fromEntries(formData.entries());
    const campaign = all.campaign || "other";

  const data = {
      name: all.name || "",
      mobile: all.mobile || "",
      gender: all.gender || "",
      campaign: campaign,
      food: {},
      transport: {},
      logistics: {},
      mina: {},
      arafat: {},
      notes: {
        positive: all.positive || "",
        negative: all.negative || "",
        suggestions: all.suggestions || ""
      }
    };

   Object.entries(all).forEach(([key, value]) => {
  const q = parseInt(key.replace("q", ""));
  if (!q) return;
  if (q >= 1 && q <= 9) data.food[key] = value;
  else if (q >= 10 && q <= 13) data.transport[key] = value;
  else if (q >= 14 && q <= 17) data.logistics[key] = value;
  else if (q >= 18 && q <= 25) data.mina[key] = value;
  else if (q >= 26 && q <= 32) data.arafat[key] = value;
});

    
    try {
      const snapshot = await db.collection("evaluation").where("campaign", "==", campaign).get();
      const docId = campaign.toLowerCase() + "_" + (snapshot.size + 1);
      await db.collection("evaluation").doc(docId).set(data);
      loading.style.display = "none"; 
      thankyou.style.display = "block";
    } catch (error) {
      loading.innerHTML = "<p style='color:red;'>حدث خطأ أثناء الإرسال، حاول مرة أخرى.</p>";
      console.error(error);
    }
  });

  function updateCounters() {
    document.querySelectorAll('.counter').forEach(counter => {
      const section = counter.closest('.section');
      const requiredInputs = section.querySelectorAll('select[required], input[required]:not([type=radio]), textarea[required]');
      const radioGroups = [...new Set([...section.querySelectorAll('input[type=radio]')].map(r => r.name))];
      let filledRadios = radioGroups.filter(name => section.querySelector(`input[name="${name}"]:checked`)).length;
      let filled = 0;
      requiredInputs.forEach(input => {
        if (input.value.trim() !== "") filled++;
      });
      const total = parseInt(counter.dataset.total);
      counter.textContent = (filled + filledRadios) + "/" + total;
    });
  }

  document.querySelectorAll('.radio-group').forEach(group => {
    const options = group.querySelectorAll('.radio-option');
    options.forEach(option => {
      option.addEventListener('click', () => {
        options.forEach(o => o.classList.remove('selected', 'excellent', 'good', 'average', 'poor'));

        const input = option.querySelector('input');
        input.checked = true;
        option.classList.add('selected');

        const value = input.value;
        if (value === 'ممتاز') option.classList.add('excellent');
        else if (value === 'جيد') option.classList.add('good');
        else if (value === 'مقبول') option.classList.add('average');
        else if (value === 'ضعيف') option.classList.add('poor');

        updateCounters();
      });
    });
  });

  window.addEventListener('load', updateCounters);
  form.addEventListener('input', updateCounters);
</script>

</body>
</html>
